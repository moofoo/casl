{"version":3,"file":"index.js","sources":["../../src/value-converter/can.ts","../../src/index.ts"],"sourcesContent":["import { signalBindings } from 'aurelia-framework';\nimport { PureAbility, AnyAbility } from '@casl/ability';\n\nconst ABILITY_CHANGED_SIGNAL = 'caslAbilityChanged';\nconst HAS_AU_SUBSCRIPTION = new WeakMap<object, boolean>();\n\nclass AbilityValueConverter<T extends AnyAbility> {\n  static inject = [PureAbility];\n\n  public readonly signals = [ABILITY_CHANGED_SIGNAL];\n  protected readonly _ability!: T;\n\n  constructor(ability: T) {\n    this._ability = ability;\n  }\n\n  can(...args: Parameters<T['can']>): boolean {\n    if (!HAS_AU_SUBSCRIPTION.has(this._ability)) {\n      this._ability.on('updated', () => signalBindings(ABILITY_CHANGED_SIGNAL));\n      HAS_AU_SUBSCRIPTION.set(this._ability, true);\n    }\n\n    return this._ability.can(...args as [any, any?, any?]);\n  }\n}\n\nexport class CanValueConverter<T extends AnyAbility> extends AbilityValueConverter<T> {\n  static $resource = {\n    name: 'can',\n    type: 'valueConverter'\n  };\n\n  toView(\n    subject: Parameters<T['can']>[1],\n    action: Parameters<T['can']>[0],\n    field?: string\n  ): boolean {\n    // eslint-disable-next-line\n    console.warn('`can` value converter is deprecated. Use `able` converter instead');\n    return (this as any).can(action, subject, field);\n  }\n}\n\nexport class AbleValueConverter<T extends AnyAbility> extends AbilityValueConverter<T> {\n  static $resource = {\n    name: 'able',\n    type: 'valueConverter'\n  };\n\n  toView(...args: Parameters<T['can']>): boolean {\n    return this.can(...args);\n  }\n}\n","import { FrameworkConfiguration } from 'aurelia-framework';\nimport { PureAbility, AnyAbility } from '@casl/ability';\nimport { CanValueConverter, AbleValueConverter } from './value-converter/can';\n\nexport { CanValueConverter, AbleValueConverter } from './value-converter/can';\n\nexport function configure(config: FrameworkConfiguration, defaultAbility?: AnyAbility) {\n  if (defaultAbility && defaultAbility instanceof PureAbility) {\n    config.container.registerInstance(PureAbility, defaultAbility);\n  }\n\n  config.globalResources([\n    CanValueConverter,\n    AbleValueConverter\n  ]);\n}\n"],"names":["ABILITY_CHANGED_SIGNAL","HAS_AU_SUBSCRIPTION","WeakMap","AbilityValueConverter","ability","signals","_ability","can","has","on","signalBindings","set","args","inject","PureAbility","CanValueConverter","toView","subject","action","field","console","warn","$resource","name","type","AbleValueConverter","configure","config","defaultAbility","container","registerInstance","globalResources"],"mappings":";;;;;;;;;;;;;;;;;;;;;;EAGA,IAAMA,sBAAsB,GAAG,oBAA/B;EACA,IAAMC,mBAAmB,GAAG,IAAIC,OAAJ,EAA5B;;MAEMC;EAMJ,iCAAYC,OAAZ,EAAwB;EAAA,SAHRC,OAGQ,GAHE,CAACL,sBAAD,CAGF;EACtB,SAAKM,QAAL,GAAgBF,OAAhB;EACD;;;;WAEDG,MAAA,eAA4C;EAAA;;EAC1C,QAAI,CAACN,mBAAmB,CAACO,GAApB,CAAwB,KAAKF,QAA7B,CAAL,EAA6C;EAC3C,WAAKA,QAAL,CAAcG,EAAd,CAAiB,SAAjB,EAA4B;EAAA,eAAMC,+BAAc,CAACV,sBAAD,CAApB;EAAA,OAA5B;;EACAC,MAAAA,mBAAmB,CAACU,GAApB,CAAwB,KAAKL,QAA7B,EAAuC,IAAvC;EACD;;EAJyC,sCAArCM,IAAqC;EAArCA,MAAAA,IAAqC;EAAA;;EAM1C,WAAO,uBAAKN,QAAL,EAAcC,GAAd,uBAAqBK,IAArB,CAAP;EACD;;;;;EAjBGT,sBACGU,SAAS,CAACC,mBAAD;MAmBLC,iBAAb;EAAA;;EAAA;EAAA;EAAA;;EAAA;;EAAA,UAMEC,MANF,GAME,gBACEC,OADF,EAEEC,MAFF,EAGEC,KAHF,EAIW;EACT;EACAC,IAAAA,OAAO,CAACC,IAAR,CAAa,mEAAb;EACA,WAAQ,IAAD,CAAcd,GAAd,CAAkBW,MAAlB,EAA0BD,OAA1B,EAAmCE,KAAnC,CAAP;EACD,GAdH;;EAAA;EAAA,EAA6DhB,qBAA7D;EAAaY,kBACJO,YAAY;EACjBC,EAAAA,IAAI,EAAE,KADW;EAEjBC,EAAAA,IAAI,EAAE;EAFW;MAgBRC,kBAAb;EAAA;;EAAA;EAAA;EAAA;;EAAA;;EAAA,UAMET,MANF,GAME,kBAA+C;EAC7C,WAAO,KAAKT,GAAL,uBAAP;EACD,GARH;;EAAA;EAAA,EAA8DJ,qBAA9D;EAAasB,mBACJH,YAAY;EACjBC,EAAAA,IAAI,EAAE,MADW;EAEjBC,EAAAA,IAAI,EAAE;EAFW;;ECtCd,SAASE,SAAT,CAAmBC,MAAnB,EAAmDC,cAAnD,EAAgF;EACrF,MAAIA,cAAc,IAAIA,cAAc,YAAYd,mBAAhD,EAA6D;EAC3Da,IAAAA,MAAM,CAACE,SAAP,CAAiBC,gBAAjB,CAAkChB,mBAAlC,EAA+Cc,cAA/C;EACD;;EAEDD,EAAAA,MAAM,CAACI,eAAP,CAAuB,CACrBhB,iBADqB,EAErBU,kBAFqB,CAAvB;EAID;;;;;;;;;;;;"}